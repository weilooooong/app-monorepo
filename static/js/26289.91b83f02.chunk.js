"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[26289],{526289:(e,n,t)=>{t.r(n),t.d(n,{default:()=>N});var o=t(539144),a=t(53594),r=t(481047),l=t(877531),i=t(669083),u=t(634795),s=t(196234),d=t(921311),c=t(202784),f=t(783112),m=t(945821),g=t(859071),h=t(826771),p=t(958698),y=t(648431),v=t(280553),b=t(552322);const I=function(){var e,n,t,a,r=(0,f.default)(),I=(0,o.default)(),w=(0,g.useNavigation)(),_=(0,g.useActiveWalletAccount)(),x=_.accountId,k=_.networkId,j=(0,p.default)().sourceInfo,M=null==j?void 0:j.data.params,A=(0,h.default)({id:null!=(e=null==j?void 0:j.id)?e:"",closeWindowAfterResolved:!0}),C=(0,d.default)({defaultValues:{amount:`${null!=(n=M.amount)?n:""}`,description:null!=(t=M.defaultMemo)?t:""}}),P=C.handleSubmit,R=(0,g.useNativeToken)(k),W=(0,c.useState)(!1),N=(0,s.default)(W,2),S=N[0],V=N[1],B=(0,c.useRef)(),D=(0,c.useCallback)(function(){var e=(0,u.default)((function*(e){if(!S&&k&&x){V(!0);var n=e.amount||"0";try{var t=yield m.default.serviceLightningNetwork.createInvoice({networkId:k,accountId:x,amount:n,description:e.description});i.default.show({title:"Invoice created"}),yield A.resolve({close:B.current,result:{paymentRequest:t.payment_request,paymentHash:t.payment_hash}})}catch(l){var o=l.key,a=l.info;return o&&"onekey_error"!==o?(i.default.show({title:r.formatMessage({id:o},null!=a?a:{})},{type:"error"}),!1):(i.default.show({title:(null==l?void 0:l.message)||l},{type:"error"}),A.reject(),!1)}finally{V(!1)}}}));return function(n){return e.apply(this,arguments)}}(),[S,k,r,x,A]),T=P(D);return(0,b.jsx)(l.default,{header:r.formatMessage({id:"title__create_invoice"}),headerDescription:(0,b.jsx)(v.LNModalDescription,{networkId:k}),primaryActionTranslationId:"action__create",primaryActionProps:{isDisabled:S,isLoading:S},onPrimaryActionPress:function(e){var n=e.close;B.current=n,T()},secondaryActionTranslationId:"action__cancel",onSecondaryActionPress:function(){null!=w&&null!=w.canGoBack&&w.canGoBack()&&w.goBack()},onModalClose:function(){A.reject()},height:"auto",scrollViewProps:{contentContainerStyle:{flex:1,paddingVertical:I?16:24},children:(0,b.jsx)(y.default,{isWebln:!0,accountId:x,networkId:null!=k?k:"",useFormReturn:C,amount:Number(M.amount),minimumAmount:Number(M.minimumAmount),maximumAmount:Number(M.maximumAmount),origin:null!=(a=null==j?void 0:j.origin)?a:"",memo:M.defaultMemo,nativeToken:R,amountReadOnly:Number(M.amount)>0})}})};var w=t(472719),_=t(18861),x=t(866904),k=t(566147),j=t(46486),M=t(261961),A=t(517972);const C=function(e){var n,t=e.networkId,o=e.useFormReturn,a=e.origin,r=e.message,l=e.signature,i=(0,f.default)(),u=o.control,s=(0,A.useInteractWithInfo)({sourceInfo:{id:"mockId",hostname:"",scope:"webln",origin:a,data:{method:"signMessage"}}});return(0,b.jsxs)(k.default,{children:[(0,b.jsx)(k.default.Item,{label:i.formatMessage({id:"form__request_from"}),name:"requestFrom",control:u,formControlProps:{width:"full"},children:(0,b.jsx)(M.TxInteractInfo,{origin:null!=(n=null==s?void 0:s.url)?n:"",name:null==s?void 0:s.name,icon:null==s?void 0:s.icons[0],networkId:t,mb:0})}),(0,b.jsx)(k.default.Item,{label:i.formatMessage({id:"form__message_uppercase"}),control:u,name:"message",formControlProps:{width:"full"},defaultValue:"",children:(0,b.jsx)(_.default,{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",borderWidth:j.default.hairlineWidth,borderColor:"border-default",borderRadius:"xl",py:2,px:3,bgColor:"action-secondary-default",children:(0,b.jsx)(x.default,{typography:"Body2Mono",color:"text-subdued",lineHeight:"1.5em",children:r})})}),l&&l.length>0?(0,b.jsx)(k.default.Item,{label:"Signature",control:u,name:"message",formControlProps:{width:"full"},defaultValue:"",children:(0,b.jsx)(_.default,{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",borderWidth:j.default.hairlineWidth,borderColor:"border-default",borderRadius:"xl",py:2,px:3,bgColor:"action-secondary-default",children:(0,b.jsx)(x.default,{typography:"Body2Mono",color:"text-subdued",lineHeight:"1.5em",numberOfLines:10,children:l})})}):null]})};const P=function(){var e,n,t=(0,f.default)(),a=(0,o.default)(),r=(0,w.useNavigation)(),g=(0,p.default)(),y=g.sourceInfo,I=g.networkId,_=g.accountId,x=null==y?void 0:y.data.params,k=x.message,j=x.signature,M=(0,h.default)({id:null!=(e=null==y?void 0:y.id)?e:"",closeWindowAfterResolved:!0}),A=(0,d.default)(),P=(0,c.useState)(!1),R=(0,s.default)(P,2),W=R[0],N=R[1],S=(0,c.useCallback)(function(){var e=(0,u.default)((function*(e){var n=e.close;if(!W){N(!0);try{var o=yield m.default.serviceLightningNetwork.weblnVerifyMessage({accountId:null!=_?_:"",networkId:null!=I?I:"",message:k,signature:j});i.default.show({title:t.formatMessage({id:o?"msg__message_verification_successful":"msg__verification_error_invalid_signature"})}),setTimeout((function(){if(!o)return M.reject(),void(null==n||n());M.resolve({close:n,result:o})}),300)}catch(l){var a=l.key,r=l.info;return a&&"onekey_error"!==a?(i.default.show({title:t.formatMessage({id:a},null!=r?r:{})},{type:"error"}),M.reject(),!1):(i.default.show({title:(null==l?void 0:l.message)||l},{type:"error"}),!1)}finally{N(!1)}}}));return function(n){return e.apply(this,arguments)}}(),[t,W,_,I,M,k,j]);return(0,b.jsx)(l.default,{header:t.formatMessage({id:"title__verify_message"}),headerDescription:(0,b.jsx)(v.LNModalDescription,{networkId:I}),primaryActionTranslationId:"action__verify__webln",primaryActionProps:{isDisabled:W,isLoading:W},onPrimaryActionPress:function(e){var n=e.close;S({close:n})},secondaryActionTranslationId:"action__cancel",onSecondaryActionPress:function(){null!=r&&null!=r.canGoBack&&r.canGoBack()&&r.goBack()},onModalClose:function(){M.reject()},height:"auto",scrollViewProps:{contentContainerStyle:{flex:1,paddingVertical:a?16:24},children:(0,b.jsx)(C,{accountId:null!=_?_:"",networkId:null!=I?I:"",useFormReturn:A,origin:null!=(n=null==y?void 0:y.origin)?n:"",message:k,signature:j})}})};var R=(0,t(324665).default)(),W=[{name:r.WeblnModalRoutes.MakeInvoice,component:I},{name:r.WeblnModalRoutes.VerifyMessage,component:P},{name:r.WeblnModalRoutes.WeblnAuthentication,component:a.default}];const N=function(){var e=(0,o.default)();return(0,b.jsx)(R.Navigator,{screenOptions:{headerShown:!1,animationEnabled:!!e},children:W.map((function(e){return(0,b.jsx)(R.Screen,{name:e.name,component:e.component},e.name)}))})}}}]);