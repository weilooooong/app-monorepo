"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[30756],{786141:(e,t,r)=>{r.r(t),r.d(t,{VaultBase:()=>k,VaultBaseChainOnly:()=>N});var n=r(72579),i=r.n(n),o=r(256666),a=r(301842),u=r.n(a),c=r(634795),s=r(887371),d=r(545754),l=r(411987),f=r(695058),p=r(206391),h=r.n(p),y=r(636393),v=r(613549),g=r(292147),m=r(213208),w=r(992431),I=r(940915),T=r(278489),x=r(969618),b=r(398514),O=r(114540),A=r(348834).Buffer;function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function C(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.default)(e);if(t){var i=(0,f.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,l.default)(this,r)}}if(m.default.isExtensionUi)throw new Error("engine/VaultBase is not allowed imported from ui");var N=function(e){(0,d.default)(r,e);var t=C(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.initProvider=function(){var e=(0,c.default)((function*(){var e=(yield this.getNetwork()).impl;u()(x.IMPL_MAPPINGS[e])||(this.engineProvider=yield this.engine.providerManager.getProvider(this.networkId))}));return function(){return e.apply(this,arguments)}}(),n.proxyJsonRPCCall=function(){var e=(0,c.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.createClientFromURL=function(e){throw new I.NotImplemented},n.getEthersProvider=function(){var e=(0,c.default)((function*(){throw new I.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.getClientEndpointStatus=function(){var e=(0,c.default)((function*(e){var t=this.createClientFromURL(e),r=performance.now(),n=(yield t.getInfo()).bestBlockNumber;return{responseTime:Math.floor(performance.now()-r),latestBlock:n}}));return function(t){return e.apply(this,arguments)}}(),n.checkRpcBatchSupport=function(){var e=(0,c.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getDisplayAddress=function(){var e=(0,c.default)((function*(e){return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.validateAddress=function(){var e=(0,c.default)((function*(e){var t=yield this.engineProvider.verifyAddress(e),r=t.normalizedAddress;if(!t.isValid||!r)throw new I.InvalidAddress;return Promise.resolve(r)}));return function(t){return e.apply(this,arguments)}}(),n.validateImportedCredential=function(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^(0x)?[0-9a-zA-Z]{64}$/.test(e))},n.validateWatchingCredential=function(){var e=(0,c.default)((function*(e){return Promise.resolve(this.settings.watchingAccountEnabled&&(yield this.engineProvider.verifyAddress(e)).isValid)}));return function(t){return e.apply(this,arguments)}}(),n.validateTokenAddress=function(){var e=(0,c.default)((function*(e){var t=yield this.engineProvider.verifyTokenAddress(e),r=t.normalizedAddress;if(!t.isValid||"undefined"===typeof r)throw new I.InvalidTokenAddress;return Promise.resolve(r)}));return function(t){return e.apply(this,arguments)}}(),n.validateCanCreateNextAccount=function(){var e=(0,c.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,r){return e.apply(this,arguments)}}(),n.checkAccountExistence=function(){var e=(0,c.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,r){return e.apply(this,arguments)}}(),n.getBalances=function(){var e=(0,c.default)((function*(e,t,r){return(yield this.engine.providerManager.getClient(this.networkId)).getBalances(e.map((function(e){var t=e.address,r=e.tokenAddress;return{address:t,coin:P({},"string"===typeof r?{tokenAddress:r}:{})}})))}));return function(t,r,n){return e.apply(this,arguments)}}(),n.getFrozenBalance=function(){var e=(0,c.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return 0}));return function(){return e.apply(this,arguments)}}(),n.fetchBalanceDetails=function(){var e=(0,c.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return Promise.resolve(void 0)}));return function(){return e.apply(this,arguments)}}(),n.getTransactionStatuses=function(e){return this.engine.providerManager.getTransactionStatuses(this.networkId,e)},n.getTransactionFeeInNative=function(e){return Promise.resolve("")},n.isContractAddress=function(){var e=(0,c.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNameInfoMap=function(){var e=(0,c.default)((function*(){var e=yield this.getNetwork();return(0,T.getAccountNameInfoByImpl)(e.impl)}));return function(){return e.apply(this,arguments)}}(),n.canAutoCreateNextAccount=function(){var e=(0,c.default)((function*(e){return Promise.resolve(!1)}));return function(t){return e.apply(this,arguments)}}(),n.filterAccounts=function(){var e=(0,c.default)((function*(e){var t=e.accounts;e.networkId;return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),n.shouldChangeAccountWhenNetworkChanged=function(){var e=(0,c.default)((function*(e){e.previousNetwork,e.newNetwork,e.activeAccountId;return Promise.resolve({shouldReloadAccountList:!1,shouldChangeActiveAccount:!1})}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNameInfosByImportedOrWatchingCredential=function(){var e=(0,c.default)((function*(e){return Promise.resolve([])}));return function(t){return e.apply(this,arguments)}}(),n.checkIsUnlimitedAllowance=function(){var e=(0,c.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.checkIsApprovedForAll=function(){var e=(0,c.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.checkIsBatchTransfer=function(){var e=(0,c.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getFeePricePerUnit=function(){var e=(0,c.default)((function*(){throw new I.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.fetchRpcChainId=function(){var e=(0,c.default)((function*(e){return null}));return function(t){return e.apply(this,arguments)}}(),n.getTxWaitingSeconds=function(){var e=(0,c.default)((function*(){return[]}));return function(){return e.apply(this,arguments)}}(),n.getUserNFTAssets=function(){var e=(0,c.default)((function*(e){e.serviceData;return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),n.getTransactionDetail=function(){var e=(0,c.default)((function*(e){return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),(0,s.default)(r)}(O.VaultContext),k=function(e){(0,d.default)(r,e);var t=C(r);function r(){for(var e,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).uuid=y.default.v4().toString(),e}var n=r.prototype;return n.init=function(){var e=(0,c.default)((function*(e){yield this.initProvider(),yield this.initKeyring(e)}));return function(t){return e.apply(this,arguments)}}(),n.initKeyring=function(){var e=(0,c.default)((function*(e){this.keyring=yield e.keyringCreator(this)}));return function(t){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,c.default)((function*(e,t){return this.keyring.signTransaction(e,t)}));return function(t,r){return e.apply(this,arguments)}}(),n.signAndSendTransaction=function(){var e=(0,c.default)((function*(e,t,r){var n=yield this.signTransaction(e,t);return r?P(P({},n),{},{encodedTx:e.encodedTx}):this.broadcastTransaction(P(P({},n),{},{encodedTx:e.encodedTx}))}));return function(t,r,n){return e.apply(this,arguments)}}(),n.broadcastTransaction=function(){var e=(0,c.default)((function*(e,t){g.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var r=yield this.engine.providerManager.broadcastTransaction(this.networkId,e.rawTx,t);return g.default.engine.info("broadcastTransaction END:",{txid:r,rawTx:e.rawTx}),P(P({},e),{},{txid:r,encodedTx:e.encodedTx})}));return function(t,r){return e.apply(this,arguments)}}(),n.buildEncodedTxFromBatchTransfer=function(){var e=(0,c.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.buildEncodedTxsFromSetApproveForAll=function(){var e=(0,c.default)((function*(e,t){throw new I.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.activateAccount=function(){var e=(0,c.default)((function*(){throw new I.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.activateToken=function(){var e=(0,c.default)((function*(e,t){throw new I.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.getTokenAllowance=function(){var e=(0,c.default)((function*(e,t){throw new I.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.batchTokensAllowance=function(){var e=(0,c.default)((function*(e,t){throw new I.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.getOutputAccount=function(){var e=(0,c.default)((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,template:e.template,pubKey:i()(e,"pub","")}}));return function(){return e.apply(this,arguments)}}(),n.getAccountBalance=function(){var e=(0,c.default)((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=(yield this.getDbAccount()).address;return this.getBalances((t?[{address:i}]:[]).concat(e.map((function(e){return{address:i,tokenAddress:e}}))),r,n)}));return function(t){return e.apply(this,arguments)}}(),n.updatePendingTxs=function(){var e=(0,c.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNonce=function(){var e=(0,c.default)((function*(){return Promise.resolve(null)}));return function(){return e.apply(this,arguments)}}(),n.fixActionDirection=function(){var e=(0,c.default)((function*(e){var t,r,n,i,o=e.action,a=e.accountAddress;(o.direction=b.IDecodedTxDirection.OTHER,o.type===b.IDecodedTxActionType.NATIVE_TRANSFER)&&(o.direction=yield this.buildTxActionDirection({from:(null==(t=o.nativeTransfer)?void 0:t.from)||"",to:(null==(r=o.nativeTransfer)?void 0:r.to)||"",address:a}));o.type===b.IDecodedTxActionType.TOKEN_TRANSFER&&(o.direction=yield this.buildTxActionDirection({from:(null==(n=o.tokenTransfer)?void 0:n.from)||"",to:(null==(i=o.tokenTransfer)?void 0:i.to)||"",address:a}));return o}));return function(t){return e.apply(this,arguments)}}(),n.fixDecodedTx=function(){var e=(0,c.default)((function*(e){var t,r;e.createdAt=null!=(t=e.createdAt)?t:Date.now();var n=null==(r=e.encodedTx)?void 0:r.nonce;e.nonce=u()(n)?e.nonce:new(h())(n).toNumber();for(var i=e.owner,o=0;o<e.actions.length;o+=1){var a=e.actions[o];yield this.fixActionDirection({action:a,accountAddress:i})}if(e.outputActions)for(var c=0;c<e.outputActions.length;c+=1){var s=e.outputActions[c];yield this.fixActionDirection({action:s,accountAddress:i})}return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.fixHistoryTx=function(){var e=(0,c.default)((function*(e){return e.decodedTx=yield this.fixDecodedTx(e.decodedTx),Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.buildHistoryTx=function(){var e=(0,c.default)((function*(e){var t=e.historyTxToMerge,r=(e.encodedTx,e.decodedTx),n=e.signedTx,i=e.isSigner,o=e.isLocalCreated,a=(null==n?void 0:n.txid)||(null==r?void 0:r.txid)||"";if(!a)throw new Error("buildHistoryTx txid not found");var u=yield this.getAccountAddress();r.txid=a||r.txid,r.owner=u,i&&(r.signer=u),null!=n&&n.txKey&&(r.extraInfo?r.extraInfo.txKey=n.txKey:r.extraInfo={txKey:n.txKey});var c=P(P({id:`${this.networkId}_${a}_${this.accountId}`,isLocalCreated:Boolean(o)},t),{},{decodedTx:r});return c=yield this.fixHistoryTx(c),Promise.resolve(c)}));return function(t){return e.apply(this,arguments)}}(),n.checkIsScamHistoryTx=function(){var e=(0,c.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),n.fetchOnChainHistory=function(){var e=(0,c.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.fixAddressCase=function(e){return Promise.resolve(e)},n.buildTxActionDirection=function(){var e=(0,c.default)((function*(e){var t=e.from,r=e.to,n=e.address;return t=yield this.fixAddressCase(t||""),r=yield this.fixAddressCase(r),n=yield this.fixAddressCase(n),t===r&&t===n?b.IDecodedTxDirection.SELF:t&&t===n?b.IDecodedTxDirection.OUT:r&&r===n?b.IDecodedTxDirection.IN:b.IDecodedTxDirection.OTHER}));return function(t){return e.apply(this,arguments)}}(),n.getNextNonce=function(){var e=(0,c.default)((function*(e,t){var r,n,i=null!=(r=null==(n=(yield this.engine.providerManager.getAddresses(e,[t.address]))[0])?void 0:n.nonce)?r:0,o=(yield this.engine.getHistory(e,t.id,void 0,!1),yield w.default.history.getMaxPendingNonce({accountId:this.accountId,networkId:e})),a=yield w.default.history.getPendingNonceList({accountId:this.accountId,networkId:e}),c=Math.max(u()(o)?0:o+1,i);if(Number.isNaN(c)&&(c=i),c>i)for(var s=i;s<c;s+=1)if(!a.includes(s)){c=s;break}if(c<i&&(c=i),c-i>=v.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH)throw new I.PendingQueueTooLong(v.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH);return c}));return function(t,r){return e.apply(this,arguments)}}(),n.validateSendAmount=function(e,t,r){return Promise.resolve(!0)},n.notifyChainChanged=function(e,t){},n.getFetchBalanceAddress=function(e){return Promise.resolve(e.address)},n.getPrivateKeyByCredential=function(e){return Promise.resolve(A.from(e.startsWith("0x")?e.slice(2):e,"hex"))},n.getMinDepositAmount=function(){var e=(0,c.default)((function*(){return"0"}));return function(){return e.apply(this,arguments)}}(),n.specialCheckEncodedTx=function(){var e=(0,c.default)((function*(e){return{success:!0}}));return function(t){return e.apply(this,arguments)}}(),n.getAllUsedAddress=function(){var e=(0,c.default)((function*(){return Promise.resolve([])}));return function(){return e.apply(this,arguments)}}(),(0,s.default)(r)}(N)},830756:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Ve});var n=r(256666),i=r(703440),o=r.n(i),a=r(196234),u=r(545455),c=r.n(u),s=r(301842),d=r.n(s),l=r(634795),f=r(887371),p=r(545754),h=r(411987),y=r(695058),v=r(656848),g=r(206391),m=r.n(g),w=r(940915),I=r(901187),T=r(740727),x=r(398514),b=r(392853),O=r(368652),A=r(786141),E=r(945821),P=r(534159),C=r(292147),N=r(396564),k=r(84658),D=r(278489),R=r(398145),B=r(82406),S=r(153546),H=r(613549),F={ecdsa:new Uint8Array([2]),ed25519:new Uint8Array([0]),ethereum:new Uint8Array([2]),sr25519:new Uint8Array([1])},K=r(970674);function U(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function M(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?U(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,y.default)(e);if(t){var i=(0,y.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,h.default)(this,r)}}var j=`m/44'/${H.COINTYPE_DOT}'`,V=K.default.u8aConcat,$=function(e){(0,p.default)(r,e);var t=_(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getChainInfo=function(){var e=(0,l.default)((function*(){return this.engine.providerManager.getChainInfoByNetworkId(this.networkId)}));return function(){return e.apply(this,arguments)}}(),n.getChainInfoImplOptions=function(){var e=(0,l.default)((function*(){return(yield this.getChainInfo()).implOptions}));return function(){return e.apply(this,arguments)}}(),n.prepareAccounts=function(){var e=(0,l.default)((function*(e){var t,r=e.indexes,n=e.names,i=r.map((function(e){return`${j}/${e}'/0'/0'`})),o=yield this.getHardwareSDKInstance(),a=yield this.getHardwareInfo(),u=a.connectId,c=a.deviceId,s=yield this.getWalletPassphraseState(),d=yield this.getChainInfoImplOptions(),l=yield this.getNetworkChainId();try{t=yield o.polkadotGetAddress(u,c,M({bundle:i.map((function(e){return{path:e,showOnOneKey:false,prefix:d.addressPrefix,network:l}}))},s))}catch(T){throw C.default.common.error(T),new w.OneKeyHardwareError(T)}if(!t.success)throw C.default.common.error(t.payload),(0,S.convertDeviceError)(t.payload);var f=[],p=0;for(var h of t.payload){var y=h.address,v=h.path,g=h.publicKey;if(y){var m=(0,D.getAccountNameInfoByImpl)(H.IMPL_DOT).default.prefix,I=(n||[])[p]||`${m} #${r[p]+1}`;f.push({id:`${this.walletId}--${v}`,name:I,type:R.AccountType.VARIANT,path:v,coinType:H.COINTYPE_DOT,pub:g||"",address:"",addresses:{}}),p+=1}}return f}));return function(t){return e.apply(this,arguments)}}(),n.getAddress=function(){var e=(0,l.default)((function*(e){var t,r=yield this.getHardwareSDKInstance(),n=yield this.getHardwareInfo(),i=n.connectId,o=n.deviceId,a=yield this.getChainInfoImplOptions(),u=yield this.getNetworkChainId(),c=yield this.getWalletPassphraseState(),s=yield r.polkadotGetAddress(i,o,M({path:e.path,prefix:a.addressPrefix,network:u,showOnOneKey:e.showOnOneKey},c));if(s.success&&null!=(t=s.payload)&&t.address)return s.payload.address;throw(0,S.convertDeviceError)(s.payload)}));return function(t){return e.apply(this,arguments)}}(),n.batchGetAddress=function(){var e=(0,l.default)((function*(e){var t=yield this.getHardwareSDKInstance(),r=yield this.getHardwareInfo(),n=r.connectId,i=r.deviceId,o=yield this.getChainInfoImplOptions(),a=yield this.getNetworkChainId(),u=yield this.getWalletPassphraseState(),c=yield t.polkadotGetAddress(n,i,M(M({},u),{},{bundle:e.map((function(e){return{path:e.path,showOnOneKey:!!e.showOnOneKey,prefix:o.addressPrefix,network:a}}))}));if(!c.success)throw(0,S.convertDeviceError)(c.payload);return c.payload.map((function(e){var t,r;return{path:null!=(t=e.path)?t:"",address:null!=(r=e.address)?r:""}}))}));return function(t){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,l.default)((function*(e,t){C.default.common.info("signTransaction",e);var r=yield this.getDbAccount(),n=this.vault,i=yield this.getNetworkChainId(),o=(yield n.serializeUnsignedTransaction(e.payload.encodedTx)).rawTx,a=yield this.getHardwareInfo(),u=a.connectId,c=a.deviceId,s=yield this.getWalletPassphraseState(),d=yield this.getHardwareSDKInstance(),l=yield d.polkadotSignTransaction(u,c,M({path:r.path,network:i,rawTx:(0,k.bytesToHex)(o)},s));if(l.success){var f=l.payload.signature,p=V(F.ed25519,(0,k.hexToBytes)(f)),h=yield n.serializeSignedTransaction(e.payload.encodedTx,(0,k.bytesToHex)(p));return Promise.resolve({txid:"",rawTx:h,signature:(0,O.addHexPrefix)((0,k.bytesToHex)(p))})}throw(0,S.convertDeviceError)(l.payload)}));return function(t,r){return e.apply(this,arguments)}}(),(0,f.default)(r)}(B.KeyringHardwareBase),z=r(794292),L=r(605851),W=r(810887),G=K.default.hdLedger,q=function(e){var t=e.method,r=t.name;return function(e,t){var r=t.replace(/(_)/g,"").toLowerCase();return"balances"!==e||"transfer"!==r&&"transferkeepalive"!==r&&"transferall"!==r?"assets"!==e||"transfer"!==r&&"transferkeepalive"!==r?x.IDecodedTxActionType.UNKNOWN:x.IDecodedTxActionType.TOKEN_TRANSFER:x.IDecodedTxActionType.NATIVE_TRANSFER}(t.pallet,r)},Y=function(e,t){try{return G(e,t)}catch(n){var r=n.message;if("Expected a mnemonic with 24 words (or 25 including a password)"===r)throw new w.OneKeyInternalError(r,"msg__error_mnemonics_can_only_be_12_24");throw n}},J=r(348834).Buffer;function Q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function X(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Z(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,y.default)(e);if(t){var i=(0,y.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,h.default)(this,r)}}var ee=K.default.bufferToU8a,te=K.default.u8aConcat,re=`m/44'/${H.COINTYPE_DOT}'`,ne=function(e){(0,p.default)(r,e);var t=Z(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getChainInfo=function(){var e=(0,l.default)((function*(){return this.engine.providerManager.getChainInfoByNetworkId(this.networkId)}));return function(){return e.apply(this,arguments)}}(),n.getChainInfoImplOptions=function(){var e=(0,l.default)((function*(){return(yield this.getChainInfo()).implOptions}));return function(){return e.apply(this,arguments)}}(),n.getPrivateKeys=function(){var e=(0,l.default)((function*(e,t){var r=(yield this.getDbAccount()).path.split("/"),n=t||[r.pop()],i=r.join("/"),o=(yield this.engine.dbApi.getCredential(this.walletId,e)).entropy;if("undefined"===typeof o)throw new w.OneKeyInternalError("Unable to get credential.");var a=(0,L.mnemonicFromEntropy)(o,e);return n.map((function(t){var r=`${i}/${t}`,n=Y(a,r);return{path:r,key:(0,I.encrypt)(e,J.from(n.secretKey.slice(0,32)))}})).reduce((function(e,t){var r;return X(X({},e),{},((r={})[t.path]=t.key,r))}),{})}));return function(t,r){return e.apply(this,arguments)}}(),n.getSigners=function(){var e=(0,l.default)((function*(e,t){var r,n=yield this.getDbAccount(),i=n.address;if(1!==t.length)throw new w.OneKeyInternalError("Polkadot signers number should be 1.");if(t[0]!==i)throw new w.OneKeyInternalError("Wrong address required for signing.");var o=(yield this.getPrivateKeys(e))[n.path];if("undefined"===typeof o)throw new w.OneKeyInternalError("Unable to get signer.");return(r={})[i]=new z.Signer(o,e,"ed25519"),r}));return function(t,r){return e.apply(this,arguments)}}(),n.prepareAccounts=function(){var e=(0,l.default)((function*(e){var t=e.password,r=e.indexes,n=e.names,i=(yield this.engine.dbApi.getCredential(this.walletId,t)).entropy,o=(0,L.mnemonicFromEntropy)(i,t),a=r.map((function(e){var t=`${re}/${e}'/0'/0'`;return{path:t,pubkey:Y(o,t).publicKey}}));if(a.length!==r.length)throw new w.OneKeyInternalError("Unable to get public key.");var u=[],c=0;for(var s of a){var d=s.path,l=s.pubkey,f=(0,D.getAccountNameInfoByImpl)(H.IMPL_DOT).default.prefix,p=(n||[])[c]||`${f} #${r[c]+1}`;u.push({id:`${this.walletId}--${d}`,name:p,type:R.AccountType.VARIANT,path:d,coinType:H.COINTYPE_DOT,pub:(0,k.bytesToHex)(l),address:"",addresses:{}}),c+=1}return u}));return function(t){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,l.default)((function*(e,t){var r,n;C.default.common.info("signTransaction result",e);var i=yield this.getDbAccount(),o=this.vault,u=(yield o.serializeUnsignedTransaction(e.payload.encodedTx)).hash,c=(yield this.getSigners(t.password||"",[i.address]))[i.address];if(!(null==(r=e.inputs)||null==(n=r[0])?void 0:n.publicKey))throw new w.OneKeyInternalError("Unable to get sender public key.");var s=yield c.sign(J.from(u)),d=(0,a.default)(s,1)[0],l=te(F.ed25519,ee(d)),f=yield o.serializeSignedTransaction(e.payload.encodedTx,(0,k.bytesToHex)(l));return Promise.resolve({txid:"",rawTx:f,signature:(0,O.addHexPrefix)((0,k.bytesToHex)(l))})}));return function(t,r){return e.apply(this,arguments)}}(),n.signMessage=function(){var e=(0,l.default)((function*(e,t){var r=yield this.getDbAccount(),n=(yield this.getSigners(t.password||"",[r.address]))[r.address],i=this.vault;return Promise.all(e.map(function(){var e=(0,l.default)((function*(e){var t=yield i.serializeMessage(e.message),r=yield n.sign(t),o=(0,a.default)(r,1)[0],u=te(F.ed25519,ee(o));return(0,O.addHexPrefix)((0,k.bytesToHex)(u))}));return function(t){return e.apply(this,arguments)}}()))}));return function(t,r){return e.apply(this,arguments)}}(),(0,f.default)(r)}(W.KeyringHdBase),ie=r(478557),oe=r(255942),ae=r(348834).Buffer;function ue(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,y.default)(e);if(t){var i=(0,y.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,h.default)(this,r)}}var ce=K.default.bufferToU8a,se=K.default.u8aConcat,de=function(e){(0,p.default)(r,e);var t=ue(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getChainInfo=function(){var e=(0,l.default)((function*(){return this.engine.providerManager.getChainInfoByNetworkId(this.networkId)}));return function(){return e.apply(this,arguments)}}(),n.getChainInfoImplOptions=function(){var e=(0,l.default)((function*(){return(yield this.getChainInfo()).implOptions}));return function(){return e.apply(this,arguments)}}(),n.getSigners=function(){var e=(0,l.default)((function*(e,t){var r,n=yield this.getDbAccount(),i=n.address;if(1!==t.length)throw new w.OneKeyInternalError("Cosmos signers number should be 1.");if(t[0]!==i)throw new w.OneKeyInternalError("Wrong address required for signing.");var o=(yield this.getPrivateKeys(e))[n.path];if("undefined"===typeof o)throw new w.OneKeyInternalError("Unable to get signer.");return(r={})[i]=new z.Signer(o,e,"ed25519"),r}));return function(t,r){return e.apply(this,arguments)}}(),n.prepareAccounts=function(){var e=(0,l.default)((function*(e){var t=e.privateKey,r=e.name;if(32!==t.length)throw new w.OneKeyInternalError("Invalid private key.");var n=ie.ed25519.publicFromPrivate(t).toString("hex");return Promise.resolve([{id:`imported--${H.COINTYPE_DOT}--${n}`,name:r||"",type:R.AccountType.VARIANT,path:"",coinType:H.COINTYPE_DOT,pub:n,address:"",addresses:{}}])}));return function(t){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,l.default)((function*(e,t){var r,n;C.default.common.info("signTransaction result",e);var i=yield this.getDbAccount(),o=this.vault,u=(yield o.serializeUnsignedTransaction(e.payload.encodedTx)).hash,c=(yield this.getSigners(t.password||"",[i.address]))[i.address];if(!(null==(r=e.inputs)||null==(n=r[0])?void 0:n.publicKey))throw new w.OneKeyInternalError("Unable to get sender public key.");var s=yield c.sign(ae.from(u)),d=(0,a.default)(s,1)[0],l=se(F.ed25519,ce(d)),f=yield o.serializeSignedTransaction(e.payload.encodedTx,(0,k.bytesToHex)(l));return Promise.resolve({txid:"",rawTx:f,signature:(0,O.addHexPrefix)((0,k.bytesToHex)(l))})}));return function(t,r){return e.apply(this,arguments)}}(),n.signMessage=function(){var e=(0,l.default)((function*(e,t){var r=yield this.getDbAccount(),n=(yield this.getSigners(t.password||"",[r.address]))[r.address],i=this.vault;return Promise.all(e.map(function(){var e=(0,l.default)((function*(e){var t=yield i.serializeMessage(e.message),r=yield n.sign(t),o=(0,a.default)(r,1)[0],u=se(F.ed25519,ce(o));return(0,O.addHexPrefix)((0,k.bytesToHex)(u))}));return function(t){return e.apply(this,arguments)}}()))}));return function(t,r){return e.apply(this,arguments)}}(),(0,f.default)(r)}(oe.KeyringImportedBase);function le(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,y.default)(e);if(t){var i=(0,y.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,h.default)(this,r)}}var fe=function(e){(0,p.default)(r,e);var t=le(r);function r(){return t.apply(this,arguments)}return r.prototype.prepareAccounts=function(){var e=(0,l.default)((function*(e){var t,r=e.name,n=e.target,i=e.accountIdPrefix,o=yield this.vault.validateAddress(n);if("undefined"===typeof o)throw new w.InvalidAddress;return Promise.resolve([{id:`${i}--${H.COINTYPE_DOT}--${n}`,name:r||"",type:R.AccountType.VARIANT,path:"",coinType:H.COINTYPE_DOT,pub:"",address:"",addresses:(t={},t[this.networkId]=o,t)}])}));return function(t){return e.apply(this,arguments)}}(),(0,f.default)(r)}(r(701625).KeyringWatchingBase),pe=r(817022),he=r.n(pe),ye=r(115258);r(348834).Buffer;function ve(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=Math.ceil(t/8),i=ye.blake2b.create({dkLen:n,key:r.key});return i.update(e),i.digest()}var ge=r(348834).Buffer,me=function(){function e(e,t,r){this.version=e,this.payload=t,this.checksum=r,this.version=e,this.payload=t,this.checksum=r}e.createPlaceholder=function(){if(!e.placeholder){var t=new Uint8Array(32);t.fill(0),e.placeholder=new e(ge.from([0]),ge.from(t),ge.from([0,0]))}return e.placeholder},e.from=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:42;return"string"===typeof t&&(0,O.isHexString)((0,O.addHexPrefix)(t))?e.fromPublicKey(t,r):"string"===typeof t?e.fromEncoded(t):t},e.fromPublicKey=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:42;return"string"===typeof t?e.fromPayload(ge.from(t,"hex"),r):e.fromPayload(t,r)},e.fromEncoded=function(t){return e.fromBytes(he().decode(t))},e.fromBytes=function(t){var r=ge.isBuffer(t)?t:ge.from(t),n=35===r.length?2:1;return new e(r.slice(0,1),r.slice(1,-n),r.slice(-n))},e.fromPayload=function(t,r){var n=ge.from([r]),i=this.generateChecksum(ge.concat([n,t])),o=32===t.length?2:1;return new e(n,t,i.slice(0,o))},e.generateChecksum=function(e){var t=ge.from("SS58PRE");return ge.from(ve(ge.concat([t,e]),512))};var t=e.prototype;return t.compare=function(e){return"string"===typeof e&&(0,O.isHexString)(e)?this.payload.compare(ge.from(e,"hex")):"string"===typeof e?this.getValue().localeCompare(e):this.payload.compare(e.payload)},t.getValue=function(){return this.encoded||(this.encoded=he().encode(ge.concat([this.version,this.payload,this.checksum]))),this.encoded},t.getBufferBytes=function(){return this.payload},t.getHexBytes=function(){return this.payload.toString("hex")},(0,f.default)(e)}(),we=r(210333),Ie=r(75851),Te=r(789644),xe=r.n(Te),be=r(785695),Oe=r.n(be),Ae=r(849877),Ee=(0,f.default)((function(){}));function Pe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,y.default)(e);if(t){var i=(0,y.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,h.default)(this,r)}}var Ce=function(e){(0,p.default)(r,e);var t=Pe(r);function r(){for(var e,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).cacheRequest=(0,N.memoizee)(function(){var t=(0,l.default)((function*(t,r,n){return e.request(t,r,n)}));return function(e,r,n){return t.apply(this,arguments)}}(),{promise:!0,max:10,normalizer:function(e){var t=(0,a.default)(e,3),r=t[0],n=t[1],i=t[2];return`${r}-${n}-${Oe()(i)}`},maxAge:5e3}),e}var n=r.prototype;return n.getBaseUrl=function(e){return`https://${(0,Ae.getChainIdFromNetworkId)(e)}.api.subscan.io/api`},n.postJson=function(){var e=(0,l.default)((function*(e,t,r){return(arguments.length>3&&void 0!==arguments[3]?arguments[3]:{allowCache:!0}).allowCache?this.cacheRequest(e,t,r):this.request(e,t,r)}));return function(t,r,n){return e.apply(this,arguments)}}(),n.request=function(){var e=(0,l.default)((function*(e,t,r){var n=this.getBaseUrl(e);return xe().post(`${n}/${t}`,r,{headers:{"Content-Type":"application/json"}}).then((function(e){if(0===e.data.code)return e.data.data;throw new w.OneKeyError(`SubScanClient.postJson: ${e.data.message}`)}))}));return function(t,r,n){return e.apply(this,arguments)}}(),n.getTransaction=function(){var e=(0,l.default)((function*(e,t){return this.postJson(e,"scan/extrinsic",{hash:t})}));return function(t,r){return e.apply(this,arguments)}}(),n.getTransactions=function(){var e=(0,l.default)((function*(e,t){return this.postJson(e,"scan/extrinsics",{address:t,row:20,page:0}).then((function(e){var t;return null!=(t=e.extrinsics)?t:[]}))}));return function(t,r){return e.apply(this,arguments)}}(),n.getTransactionsV2=function(){var e=(0,l.default)((function*(e,t){return this.postJson(e,"v2/scan/transfers",{address:t,row:50,page:0,direction:"all"}).then((function(e){var t;return null!=(t=e.transfers)?t:[]}))}));return function(t,r){return e.apply(this,arguments)}}(),(0,f.default)(r)}(Ee),Ne=r(348834).Buffer;function ke(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function De(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ke(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ke(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Re(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,y.default)(e);if(t){var i=(0,y.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,h.default)(this,r)}}var Be=K.default.ApiPromise,Se=K.default.HttpProvider,He=K.default.WsProvider,Fe=K.default.hexToNumber,Ke=K.default.hexToU8a,Ue=K.default.u8aConcat,Me=K.default.u8aToHex,_e=K.default.u8aToU8a,je=K.default.u8aWrapBytes,Ve=function(e){(0,p.default)(r,e);var t=Re(r);function r(){for(var e,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).keyringMap={hd:ne,hw:$,imported:de,watching:fe,external:fe},e.settings=Ie.default,e.getScanClientCache=(0,N.memoizee)((0,l.default)((function*(){return new Ce})),{promise:!0,max:1}),e.getRPCRuntimeVersionCache=(0,N.memoizee)((0,l.default)((function*(){return(yield e.getApiClient()).rpc.state.getRuntimeVersion()})),{promise:!0,primitive:!0,max:1,normalizer:function(){return`${e.networkId}`}}),e.getGenesisHashCache=(0,N.memoizee)((0,l.default)((function*(){return(yield e.getApiClient()).rpc.chain.getBlockHash(0)})),{promise:!0,primitive:!0,max:1,normalizer:function(){return`${e.networkId}`}}),e.getMetadataRpcCache=(0,N.memoizee)((0,l.default)((function*(){return(yield e.getApiClient()).rpc.state.getMetadata()})),{promise:!0,primitive:!0,max:1,normalizer:function(){return`${e.networkId}`}}),e.getRegistryCache=(0,N.memoizee)(function(){var t=(0,l.default)((function*(t){var r,n,i,o=yield e.getNetwork();if(r=d()(t.metadataRpc)||c()(t.metadataRpc)?(yield e.getMetadataRpcCache()).toHex():t.metadataRpc,!t.specVersion||c()(t.specVersion)||!t.specName||c()(t.specName)){var a=yield e.getRPCRuntimeVersionCache();n=a.specVersion.toNumber(),i=a.specName.toString()}else n=Fe((0,O.addHexPrefix)(t.specVersion)),i=t.specName;return(0,v.getRegistry)({chainName:o.name,specName:i,specVersion:n,metadataRpc:r})}));return function(e){return t.apply(this,arguments)}}(),{promise:!0,max:1,normalizer:function(){return`${e.networkId}`}}),e.getMinDepositAmountCache=(0,N.memoizee)((0,l.default)((function*(){return(yield e.getApiClient()).consts.balances.existentialDeposit.toString()})),{promise:!0,primitive:!0,max:1,normalizer:function(){return`${e.networkId}`}}),e.getNodeProvider=function(e){return"wss:"===new URL(e).protocol?new He(e):new Se(e)},e.getNodeClient=function(){var t=(0,l.default)((function*(t){var r=e.getNodeProviderCache(t);return Be.create({provider:r,initWasm:!1})}));return function(e){return t.apply(this,arguments)}}(),e.getNodeProviderCache=(0,N.memoizee)((function(t){return e.getNodeProvider(t)}),{primitive:!0,max:1,normalizer:function(e){return(0,a.default)(e,1)[0]},dispose:function(){var e=(0,l.default)((function*(e){yield e.disconnect()}));return function(t){return e.apply(this,arguments)}}()}),e.getClientCache=(0,N.memoizee)(function(){var t=(0,l.default)((function*(t){return e.getNodeClient(t)}));return function(e){return t.apply(this,arguments)}}(),{promise:!0,primitive:!0,max:1,normalizer:function(e){return(0,a.default)(e,1)[0]},dispose:function(){var e=(0,l.default)((function*(e){yield e.disconnect()}));return function(t){return e.apply(this,arguments)}}()}),e}var n=r.prototype;return n.getApiClient=function(){var e=(0,l.default)((function*(){var e=(yield this.engine.getNetwork(this.networkId)).rpcURL;return this.getClientCache(e)}));return function(){return e.apply(this,arguments)}}(),n.getClient=function(){var e=(0,l.default)((function*(){return(yield this.getChainVault()).getApiClient()}));return function(){return e.apply(this,arguments)}}(),n.getChainVault=function(){var e=(0,l.default)((function*(){return this.engine.getChainOnlyVault(this.networkId)}));return function(){return e.apply(this,arguments)}}(),n.getScanClient=function(){var e=(0,l.default)((function*(){return this.getScanClientCache()}));return function(){return e.apply(this,arguments)}}(),n.getChainInfo=function(){var e=(0,l.default)((function*(){return this.engine.providerManager.getChainInfoByNetworkId(this.networkId)}));return function(){return e.apply(this,arguments)}}(),n.getChainInfoImplOptions=function(){var e=(0,l.default)((function*(){return(yield this.getChainInfo()).implOptions}));return function(){return e.apply(this,arguments)}}(),n.addressFromAccountId=function(){var e=(0,l.default)((function*(e){var t;if(d()(e)||c()(e))return"";var r=yield this.getChainInfoImplOptions(),n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:42;return"string"===typeof e&&(0,O.isHexString)((0,O.addHexPrefix)(e))?me.fromPublicKey((0,O.stripHexPrefix)(e),t):"string"===typeof e?me.fromEncoded(e):e}(e,null!=(t=null==r?void 0:r.addressPrefix)?t:0).getValue();return n}));return function(t){return e.apply(this,arguments)}}(),n.addressFromBase=function(){var e=(0,l.default)((function*(e){var t,r=e,n=null==(t=r.addresses[this.networkId])?void 0:t.trim();return d()(n)||c()(n)?this.addressFromAccountId(r.pub):r.addresses[this.networkId]}));return function(t){return e.apply(this,arguments)}}(),n.createClientFromURL=function(e){throw new w.NotImplemented},n.getClientEndpointStatus=function(){var e=(0,l.default)((function*(e){if("wss:"===new URL(e).protocol){var t=new WebSocket(e);return new Promise((function(e,r){t.onopen=function(){var n=performance.now();t.send('{"id":1,"jsonrpc":"2.0","method":"chain_getHeader","params":[]}'),t.onmessage=function(r){var i=JSON.parse(r.data);if(1===i.id){var o=Math.floor(performance.now()-n);t.OPEN&&t.close(),e({responseTime:o,latestBlock:Fe(i.result.number)})}else t.OPEN&&t.close()},t.onerror=function(e){t.OPEN&&t.close(),r(e)}}}))}var r=this.getNodeProvider(e),n=performance.now(),i=yield r.send("chain_getHeader",[]);return{responseTime:Math.floor(performance.now()-n),latestBlock:Fe(i.number)}}));return function(t){return e.apply(this,arguments)}}(),n._getPublicKey=function(){var e=(0,l.default)((function*(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).prefix,t=void 0===e||e,r=(yield this.getDbAccount()).pub;return t&&(r=(0,O.addHexPrefix)(r)),Promise.resolve(r)}));return function(){return e.apply(this,arguments)}}(),n.validateAddress=function(){var e=(0,l.default)((function*(e){var t=yield this.getChainInfoImplOptions();return new RegExp(t.addressRegex).test(e)?Promise.resolve(e):Promise.reject(new w.InvalidAddress)}));return function(t){return e.apply(this,arguments)}}(),n.validateWatchingCredential=function(){var e=(0,l.default)((function*(e){var t=this;return this.validateAddress(e).then((function(e){return t.settings.watchingAccountEnabled&&!!e})).catch((function(){return!1}))}));return function(t){return e.apply(this,arguments)}}(),n.getBalances=function(){var e=(0,l.default)((function*(e){var t=yield this.getClient(),r=o()(e,(function(e){return e.address}));return Promise.all(Object.entries(r).map(function(){var e=(0,l.default)((function*(e){var r=(0,a.default)(e,2),n=r[0];r[1];try{var i=(yield t.query.system.account(n)).data.free;return new(m())(i.toString())}catch(o){return}}));return function(t){return e.apply(this,arguments)}}()))}));return function(t){return e.apply(this,arguments)}}(),n.buildEncodedTxFromTransfer=function(){var e=(0,l.default)((function*(e){if(!e.to)throw new Error("Invalid transferInfo.to params");var t,r,n=e.to,i=e.amount,o=e.token,a=(yield this.getDbAccount()).address,u=yield this.getClient(),c=(yield u.rpc.chain.getBlock()).block,s=yield u.rpc.chain.getBlockHash(),d=yield this.getChainVault(),l=yield d.getGenesisHashCache(),f=yield d.getMetadataRpcCache(),p=yield d.getRPCRuntimeVersionCache(),h=p.specVersion,y=p.specName,g=p.transactionVersion,I=yield u.call.accountNonceApi.accountNonce(a),T=yield this.getNetwork(),x=yield d.getRegistryCache({metadataRpc:f.toHex(),specVersion:h.toHex(),specName:y.toString()}),b={address:a,blockHash:s.toHex(),blockNumber:x.createType("BlockNumber",c.header.number).toNumber(),eraPeriod:64,genesisHash:l.toHex(),metadataRpc:f.toHex(),nonce:parseInt(I.toString()),specVersion:h.toNumber(),tip:0,transactionVersion:g.toNumber()},O={metadataRpc:f.toHex(),registry:x};if(o&&""!==o){var A=yield this.engine.ensureTokenInDB(this.networkId,o);if("undefined"===typeof A)throw new w.OneKeyInternalError("Failed to get token info.");t=new(m())(i).shiftedBy(A.decimals).toFixed(),r=null!=e&&e.keepAlive?v.methods.assets.transferKeepAlive({id:parseInt(o),target:n,amount:t},b,O):v.methods.assets.transfer({id:parseInt(o),target:n,amount:t},b,O)}else t=new(m())(i).shiftedBy(T.decimals).toFixed(),r=null!=e&&e.keepAlive?v.methods.balances.transferKeepAlive({value:t,dest:{id:n}},b,O):v.methods.balances.transfer({value:t,dest:{id:n}},b,O);return De(De({},r),{},{specName:y.toString()})}));return function(t){return e.apply(this,arguments)}}(),n.decodedTxToLegacy=function(e){return Promise.resolve({})},n.decodeTx=function(){var e=(0,l.default)((function*(e,t){var r,n=yield this.engine.getNetwork(this.networkId),i=yield this.getDbAccount(),o=yield this.engine.getNativeTokenInfo(this.networkId),u=yield this.decodeUnsignedTx(e),c=null,s=q(u);if(s===x.IDecodedTxActionType.NATIVE_TRANSFER||s===x.IDecodedTxActionType.TOKEN_TRANSFER){var d,l=s===x.IDecodedTxActionType.TOKEN_TRANSFER,f=i.address,p="nativeTransfer",h="",y="";if(l){var v,g=u.method.args,w=g.dest.id,I=g.amount;if(h=w,y=null!=(v=null==I?void 0:I.toString())?v:"0",p="tokenTransfer",!(o=yield this.engine.ensureTokenInDB(this.networkId,""))){var T=yield this.fetchTokenInfos([""]),O=(0,a.default)(T,1)[0];if(O&&(o={id:"1",isNative:!1,networkId:this.networkId,tokenIdOnNetwork:"",name:O.name,symbol:O.symbol,decimals:O.decimals,logoURI:""}),!o)throw new Error("Invalid token address")}}else{var A,E=u.method.args,P=E.dest.id,C=E.value;h=P,y=null!=(A=null==C?void 0:C.toString())?A:"0"}var N={tokenInfo:o,from:null!=f?f:"",to:h,amount:new(m())(y).shiftedBy(-o.decimals).toFixed(),amountValue:y,extraInfo:null};(d={type:s})[p]=N,c=d}else c={type:x.IDecodedTxActionType.UNKNOWN,direction:x.IDecodedTxDirection.OTHER,unknownAction:{extraInfo:{}}};var k={txid:"",owner:i.address,signer:i.address,nonce:u.nonce,actions:[c],status:x.IDecodedTxStatus.Pending,networkId:this.networkId,accountId:this.accountId,feeInfo:null!=(r=null==e?void 0:e.feeInfo)?r:{price:(0,b.convertFeeValueToGwei)({value:"1",network:n}),limit:"1"},extraInfo:null,encodedTx:e};return Promise.resolve(k)}));return function(t,r){return e.apply(this,arguments)}}(),n.fetchFeeInfo=function(){var e=(0,l.default)((function*(e,t){var r=yield this.getNetwork(),n=yield this.getClient(),i=(yield n.derive.tx.signingInfo(e.address,e.nonce,parseInt(e.era)),Ue(new Uint8Array([1]),new Uint8Array(64).fill(66))),o=yield this.serializeSignedTransaction(e,Me(i)),a=Ke(o),u="0";try{var c=(yield n.call.transactionPaymentApi.queryInfo(a,a.length)).toJSON().partialFee.toString();u=new(m())(c).toFixed(0).toString()}catch(d){var s=(yield n.call.transactionPaymentCallApi.queryCallFeeDetails(a,a.length)).toJSON();u=new(m())(s.inclusionFee.baseFee.toString()).plus(s.inclusionFee.lenFee.toString()).toFixed(0).toString()}return{disableEditFee:!0,nativeSymbol:r.symbol,nativeDecimals:r.decimals,feeSymbol:r.feeSymbol,feeDecimals:r.feeDecimals,limit:u,prices:[(0,b.convertFeeValueToGwei)({value:"1",network:r})],defaultPresetIndex:"0"}}));return function(t,r){return e.apply(this,arguments)}}(),n.attachFeeInfoToEncodedTx=function(){var e=(0,l.default)((function*(e){var t=e.feeInfoValue,r=t.price,n=t.limit;if(!r||"string"!==typeof r)throw new w.OneKeyInternalError("Invalid gas price.");if("string"!==typeof n)throw new w.OneKeyInternalError("Invalid fee limit");var i=yield this.getNetwork();(0,b.convertFeeGweiToValue)({value:r,network:i});return Promise.resolve(De(De({},e.encodedTx),{},{feeInfo:{price:r,limit:n}}))}));return function(t){return e.apply(this,arguments)}}(),n.specialCheckEncodedTx=function(){var e=(0,l.default)((function*(e){var t=yield this.getAccountBalance([]),r=(0,a.default)(t,1)[0],n=yield this.decodeUnsignedTx(e);if(q(n)===x.IDecodedTxActionType.NATIVE_TRANSFER){var i,o,u,c,s,d,l,f=n.method.args,p=f.dest.id,h=f.value;if(p===e.address)return Promise.resolve({success:!0});var y,v=yield E.default.serviceToken.getMinDepositAmount({networkId:this.networkId,accountId:this.accountId}),g=yield this.getNetwork(),w=(0,P.formatBalanceDisplay)(v,null,{unit:g.decimals}),I=(0,b.convertFeeGweiToValue)({value:null!=(i=null==e||null==(o=e.feeInfo)||null==(u=o.price)?void 0:u.toString())?i:"0",network:g}),T=new(m())(parseFloat(I)*parseFloat(null!=(c=null==e||null==(s=e.feeInfo)?void 0:s.limit)?c:"0")).toFixed(0);if(null!=r&&null!=(d=r.minus(null!=(l=null==h?void 0:h.toString())?l:"0"))&&d.minus(T).lt(v))return Promise.resolve({success:!1,key:"msg__error_dot_account_retention_prompt",params:{0:`${null!=(y=w.amount)?y:"0"} ${g.symbol}`}})}return Promise.resolve({success:!0})}));return function(t){return e.apply(this,arguments)}}(),n.updateEncodedTx=function(){var e=(0,l.default)((function*(e,t,r){if("transfer"===r.type){var n=yield this.decodeUnsignedTx(e);if(q(n)===x.IDecodedTxActionType.NATIVE_TRANSFER){var i,o;C.default.sendTx.debug("updateEncodedTx","send max amount");var a=n.method.args.dest.id,u=yield this.getChainVault(),c=yield u.getRegistryCache(e),s={address:n.address,blockHash:e.blockHash,blockNumber:Fe((0,O.addHexPrefix)(e.blockNumber)),eraPeriod:64,genesisHash:e.genesisHash,metadataRpc:e.metadataRpc,nonce:Fe((0,O.addHexPrefix)(e.nonce)),specVersion:Fe((0,O.addHexPrefix)(e.specVersion)),tip:0,transactionVersion:Fe((0,O.addHexPrefix)(e.transactionVersion))},d={metadataRpc:e.metadataRpc,registry:c},l=yield this.getNetwork(),f=new(m())(t.amount).shiftedBy(l.decimals).toFixed();return-1!==(null==(i=n.method)||null==(o=i.name)?void 0:o.indexOf("KeepAlive"))?v.methods.balances.transferKeepAlive({value:f,dest:a},s,d):v.methods.balances.transferAll({dest:a,keepAlive:!1},s,d)}}return Promise.resolve(e)}));return function(t,r,n){return e.apply(this,arguments)}}(),n.buildUnsignedTxFromEncodedTx=function(){var e=(0,l.default)((function*(e){var t=yield this.getDbAccount();return Promise.resolve({inputs:[{address:(0,O.stripHexPrefix)(t.address),value:new(m())(0),publicKey:(0,O.stripHexPrefix)(t.pub)}],outputs:[],payload:{encodedTx:e},encodedTx:e})}));return function(t){return e.apply(this,arguments)}}(),n.broadcastTransaction=function(){var e=(0,l.default)((function*(e){C.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});try{var t=yield this.getClient(),r=(yield t.rpc.author.submitExtrinsic(e.rawTx)).toHex();return C.default.engine.info("broadcastTransaction Done:",{txid:r,rawTx:e.rawTx}),De(De({},e),{},{txid:r})}catch(i){if(i instanceof w.OneKeyInternalError)throw i;var n=(i||{}).message;if(-1!==n.indexOf("Invalid Transaction: Inability to pay some fees"))throw new w.OneKeyInternalError(n,"msg__broadcast_dot_tx_Insufficient_fee");if(-1!==n.indexOf("Invalid Transaction: Transaction is outdated"))throw new w.OneKeyInternalError(n,"msg__broadcast_dot_tx_outdated");throw new w.OneKeyInternalError(n)}}));return function(t){return e.apply(this,arguments)}}(),n.getExportedCredential=function(){var e=(0,l.default)((function*(e){var t=yield this.getDbAccount();if(t.id.startsWith("hd-")||t.id.startsWith("imported")){var r=this.keyring,n=Object.values(yield r.getPrivateKeys(e)),i=(0,a.default)(n,1)[0];return`0x${(0,I.decrypt)(e,i).toString("hex")}`}throw new w.OneKeyInternalError("Only credential of HD or imported accounts can be exported")}));return function(t){return e.apply(this,arguments)}}(),n.fetchOnChainHistory=function(){var e=(0,l.default)((function*(e){var t=this,r=e.localHistory,n=void 0===r?[]:r;if(e.tokenIdOnNetwork)return Promise.resolve([]);var i=yield this.getScanClient(),o=yield this.getDbAccount(),a=(yield this.engine.getNativeTokenInfo(this.networkId)).decimals,u=(yield i.getTransactionsV2(this.networkId,o.address)).map(function(){var e=(0,l.default)((function*(e){var r=n.find((function(t){return t.decodedTx.txid===e.hash}));if(r&&r.decodedTx.isFinal)return Promise.resolve(null);try{var i,u=e.from,c=e.to,s=e.module,d=e.amount_v2,l=e.fee,f=function(e){return"balances"===e?x.IDecodedTxActionType.NATIVE_TRANSFER:"assets"===e?x.IDecodedTxActionType.TOKEN_TRANSFER:x.IDecodedTxActionType.UNKNOWN}(s),p={type:x.IDecodedTxActionType.UNKNOWN},h=yield t.engine.getNativeTokenInfo(t.networkId);if(f===x.IDecodedTxActionType.NATIVE_TRANSFER||f===x.IDecodedTxActionType.TOKEN_TRANSFER){var y,v=x.IDecodedTxDirection.IN;u===o.address&&(v=c===o.address?x.IDecodedTxDirection.SELF:x.IDecodedTxDirection.OUT);(y={type:f,direction:v}).nativeTransfer={tokenInfo:h,from:u,to:c,amount:new(m())(d).shiftedBy(-h.decimals).toFixed(),amountValue:d,extraInfo:null},p=y}var g=e.success,w=x.IDecodedTxStatus.Pending;!1===g?w=x.IDecodedTxStatus.Failed:!0===g&&(w=x.IDecodedTxStatus.Confirmed);var I={txid:e.hash,owner:o.address,signer:u,nonce:e.nonce,actions:[p],status:w,networkId:t.networkId,accountId:t.accountId,encodedTx:void 0,extraInfo:null,totalFeeInNative:new(m())(l).shiftedBy(-a).toFixed()};return I.updatedAt=1e3*e.block_timestamp,I.createdAt=null!=(i=null==r?void 0:r.decodedTx.createdAt)?i:I.updatedAt,I.isFinal=I.status===x.IDecodedTxStatus.Confirmed,yield t.buildHistoryTx({decodedTx:I,historyTxToMerge:r})}catch(T){C.default.common.error(T)}return Promise.resolve(null)}));return function(t){return e.apply(this,arguments)}}());return(yield Promise.all(u)).filter(Boolean)}));return function(t){return e.apply(this,arguments)}}(),n.getTransactionStatuses=function(){var e=(0,l.default)((function*(e){var t=this,r=yield this.getScanClient();return Promise.all(e.map(function(){var e=(0,l.default)((function*(e){try{var n=yield r.getTransaction(t.networkId,e),i=T.TransactionStatus.PENDING;return!1===n.success?i=T.TransactionStatus.CONFIRM_BUT_FAILED:n.finalized&&(i=T.TransactionStatus.CONFIRM_AND_SUCCESS),yield Promise.resolve(i)}catch(a){var o=a.message;if("404"===o||"400"===o)return Promise.resolve(T.TransactionStatus.NOT_FOUND)}}));return function(t){return e.apply(this,arguments)}}()))}));return function(t){return e.apply(this,arguments)}}(),n.validateSendAmount=function(){var e=(0,l.default)((function*(e,t,r){try{if(d()(e)||c()(e))return!0;var n=yield this.getNetwork(),i=yield E.default.serviceToken.getMinDepositAmount({networkId:this.networkId,accountId:this.accountId}),o=new(m())(i),u=new(m())(e).shiftedBy(n.decimals),s=yield this.getBalances([{address:r}]),l=(0,a.default)(s,1)[0],f=(0,P.formatBalanceDisplay)(o,null,{unit:n.decimals});if(!f.amount)return!1;if(null!=l&&l.plus(u).lt(o))throw new w.InvalidTransferValue("form__amount_recipient_activate",{amount:f.amount,unit:n.symbol});return!0}catch(p){throw console.log(p),p}}));return function(t,r,n){return e.apply(this,arguments)}}(),n.getMinDepositAmount=function(){var e=(0,l.default)((function*(){return(yield this.getChainVault()).getMinDepositAmountCache()}));return function(){return e.apply(this,arguments)}}(),n.destroy=function(){var e=(0,l.default)((function*(){yield this.getMetadataRpcCache.clear(),this.getNodeProviderCache.clear()}));return function(){return e.apply(this,arguments)}}(),n.decodeUnsignedTx=function(){var e=(0,l.default)((function*(e){var t=yield this.getChainVault(),r=yield t.getRegistryCache(e),n=e.metadataRpc;return(0,v.decode)(e,{metadataRpc:n,registry:r})}));return function(t){return e.apply(this,arguments)}}(),n.serializeUnsignedTransaction=function(){var e=(0,l.default)((function*(e){var t=e,r=t.metadataRpc,n=yield this.getChainVault(),i=yield n.getRegistryCache(t);i.setMetadata((0,v.createMetadata)(i,r));var o=v.construct.signingPayload(t,{registry:i}),a=i.createType("ExtrinsicPayload",o,{version:we.EXTRINSIC_VERSION}).toU8a({method:!0}),u=a.length>256?i.hash(a):a;return{rawTx:a,hash:_e(u)}}));return function(t){return e.apply(this,arguments)}}(),n.serializeMessage=function(){var e=(0,l.default)((function*(e){var t=je(e);return Ne.from(_e(t))}));return function(t){return e.apply(this,arguments)}}(),n.serializeSignedTransaction=function(){var e=(0,l.default)((function*(e,t){var r=e.metadataRpc,n=yield this.getChainVault(),i=yield n.getRegistryCache(e);return v.construct.signedTx(e,(0,O.addHexPrefix)(t),{metadataRpc:r,registry:i})}));return function(t,r){return e.apply(this,arguments)}}(),n.encodeUnsignedTransaction=function(){var e=(0,l.default)((function*(e){var t=yield this.getChainVault(),r=yield t.getRegistryCache(e);return v.construct.encodeUnsignedTransaction(e,{registry:r})}));return function(t){return e.apply(this,arguments)}}(),(0,f.default)(r)}(A.VaultBase)},565147:(e,t,r)=>{r.r(t),r.d(t,{KeyringBase:()=>s,KeyringBaseMock:()=>d});var n=r(634795),i=r(887371),o=r(545754),a=r(411987),u=r(695058);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var s=function(e){(0,o.default)(r,e);var t=c(r);function r(e){var r;return(r=t.call(this,e.options)).vault=e,r}return r.prototype.addressFromBase=function(){var e=(0,n.default)((function*(e){return this.vault.addressFromBase(e)}));return function(t){return e.apply(this,arguments)}}(),(0,i.default)(r)}(r(114540).VaultContext),d=function(e){(0,o.default)(r,e);var t=c(r);function r(){return t.apply(this,arguments)}return(0,i.default)(r)}(s)},82406:(e,t,r)=>{r.r(t),r.d(t,{KeyringHardwareBase:()=>l});var n=r(634795),i=r(887371),o=r(545754),a=r(411987),u=r(695058),c=r(799075),s=r(814817);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var l=function(e){(0,o.default)(a,e);var t=d(a);function a(){return t.apply(this,arguments)}var u=a.prototype;return u.getHardwareInfo=function(){var e=(0,n.default)((function*(){var e,t,r,n=yield this.engine.getHWDeviceByWalletId(this.vault.walletId);return{connectId:null!=(e=null==n?void 0:n.mac)?e:"",deviceId:null!=(t=null==n?void 0:n.deviceId)?t:"",deviceType:null!=(r=null==n?void 0:n.deviceType)?r:""}}));return function(){return e.apply(this,arguments)}}(),u.getWalletPassphraseState=function(){var e=(0,n.default)((function*(){var e=yield this.engine.getWallet(this.vault.walletId);return{passphraseState:null==e?void 0:e.passphraseState,useEmptyPassphrase:!(0,s.isPassphraseWallet)(e)}}));return function(){return e.apply(this,arguments)}}(),u.getHardwareSDKInstance=function(){var e=(0,n.default)((function*(){var e,t,n,i,o;return null!=(o=yield null==(e=r.g)||null==(t=e.$backgroundApiProxy)||null==(n=t.backgroundApi)||null==(i=n.serviceHardware)||null==i.getSDKInstance?void 0:i.getSDKInstance())?o:c.HardwareSDK}));return function(){return e.apply(this,arguments)}}(),u.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,i.default)(a)}(r(565147).KeyringBase)},810887:(e,t,r)=>{r.r(t),r.d(t,{KeyringHdBase:()=>h});var n=r(256666),i=r(634795),o=r(887371),a=r(545754),u=r(411987),c=r(695058),s=r(605851),d=r(940915);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var i=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,u.default)(this,r)}}var h=function(e){(0,a.default)(r,e);var t=p(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getPrivateKeys=function(){var e=(0,i.default)((function*(e,t){var r=(yield this.getDbAccount()).path.split("/"),n=t||[r.pop()],i=r.join("/"),o=(yield this.engine.dbApi.getCredential(this.walletId,e)).seed;if("undefined"===typeof o)throw new d.OneKeyInternalError("Unable to get credential.");var a=(yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)).curve;return(0,s.batchGetPrivateKeys)(a,o,e,i,n).reduce((function(e,t){var r;return f(f({},e),{},((r={})[t.path]=t.extendedKey.key,r))}),{})}));return function(t,r){return e.apply(this,arguments)}}(),n.getAddress=function(){throw new Error("Method not implemented.")},n.batchGetAddress=function(){throw new Error("Method not implemented.")},n.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,o.default)(r)}(r(280306).KeyringSoftwareBase)},255942:(e,t,r)=>{r.r(t),r.d(t,{KeyringImportedBase:()=>d});var n=r(634795),i=r(887371),o=r(545754),a=r(411987),u=r(695058),c=r(940915);function s(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var d=function(e){(0,o.default)(r,e);var t=s(r);function r(){return t.apply(this,arguments)}var a=r.prototype;return a.getPrivateKeys=function(){var e=(0,n.default)((function*(e,t){if("undefined"!==typeof t)throw new c.NotImplemented("Getting private keys from extended private key");var r=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof r)throw new c.OneKeyInternalError("Unable to get credential.");return{"":r}}));return function(t,r){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,i.default)(r)}(r(280306).KeyringSoftwareBase)},280306:(e,t,r)=>{r.r(t),r.d(t,{KeyringSoftwareBase:()=>y});var n=r(196234),i=r(256666),o=r(634795),a=r(887371),u=r(545754),c=r(411987),s=r(695058),d=r(292147),l=r(940915);function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,s.default)(e);if(t){var i=(0,s.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,c.default)(this,r)}}var y=function(e){(0,u.default)(r,e);var t=h(r);function r(){return t.apply(this,arguments)}var i=r.prototype;return i.signTransaction=function(){var e=(0,o.default)((function*(e,t){var r=t.password;if("undefined"===typeof r)throw new l.OneKeyInternalError("Software signing requires a password.");var n=yield this.getSigners(r,e.inputs.map((function(e){return e.address})));return d.default.engine.info("signTransaction",this.networkId,e),p(p({},yield this.engine.providerManager.signTransaction(this.networkId,e,n)),{},{encodedTx:e.encodedTx})}));return function(t,r){return e.apply(this,arguments)}}(),i.signMessage=function(){var e=(0,o.default)((function*(e,t){var r=this,i=t.password;if("undefined"===typeof i)throw new l.OneKeyInternalError("Software signing requires a password.");var o=yield this.getDbAccount(),a=Object.values(yield this.getSigners(i,[o.address])),u=(0,n.default)(a,1)[0];return d.default.engine.info("signMessage",this.networkId,e),Promise.all(e.map((function(e){return r.engine.providerManager.signMessage(r.networkId,e,u)})))}));return function(t,r){return e.apply(this,arguments)}}(),i.getAddress=function(){throw new Error("Method not implemented.")},i.batchGetAddress=function(){throw new Error("Method not implemented.")},i.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,a.default)(r)}(r(565147).KeyringBase)},701625:(e,t,r)=>{r.r(t),r.d(t,{KeyringWatchingBase:()=>d});var n=r(634795),i=r(887371),o=r(545754),a=r(411987),u=r(695058),c=r(940915);function s(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var d=function(e){(0,o.default)(r,e);var t=s(r);function r(){return t.apply(this,arguments)}var a=r.prototype;return a.signTransaction=function(){var e=(0,n.default)((function*(e,t){throw new c.OneKeyInternalError("signTransaction is not supported for watching accounts")}));return function(t,r){return e.apply(this,arguments)}}(),a.signMessage=function(){var e=(0,n.default)((function*(e,t){throw new c.OneKeyInternalError("signMessage is not supported for watching accounts")}));return function(t,r){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,i.default)(r)}(r(565147).KeyringBase)},153546:(e,t,r)=>{r.r(t),r.d(t,{convertDeviceError:()=>u});var n=r(703599),i=r(302478),o=r(292147);r(213208);function a(e,t){return"string"!==typeof t?null:e===n.HardwareErrorCode.DeviceInitializeFailed&&t.includes("ECONNABORTED")?new i.ConnectTimeoutError({message:t}):t.includes("Bridge network error")?new i.BridgeNetworkError({message:t}):null}function u(e){var t,r=e||{},u=r.code,c=r.error,s=r.message,d=null!=(t=null!=c?c:s)?t:"Unknown error";if(a(u,d))return a(u,d);switch(o.default.hardwareSDK.info("Device Utils Convert Device Error:",u,d),u){case n.HardwareErrorCode.UnknownError:return new i.UnknownHardwareError(e);case n.HardwareErrorCode.DeviceFwException:return new i.FirmwareVersionTooLow(e);case n.HardwareErrorCode.DeviceUnexpectedMode:return"string"===typeof d&&-1!==d.indexOf("ui-device_bootloader_mode")?new i.NotInBootLoaderMode(e):new i.UnknownHardwareError(e);case n.HardwareErrorCode.DeviceCheckDeviceIdError:return new i.DeviceNotSame(e);case n.HardwareErrorCode.DeviceNotFound:return new i.DeviceNotFind(e);case n.HardwareErrorCode.DeviceUnexpectedBootloaderMode:return new i.NotInBootLoaderMode(e);case n.HardwareErrorCode.DeviceInterruptedFromOutside:case n.HardwareErrorCode.DeviceInterruptedFromUser:return new i.UserCancelFromOutside(e);case n.HardwareErrorCode.DeviceNotSupportPassphrase:return new i.NotSupportPassphraseError(e);case n.HardwareErrorCode.IFrameLoadFail:return new i.InitIframeLoadFail(e);case n.HardwareErrorCode.IframeTimeout:return new i.InitIframeTimeout(e);case n.HardwareErrorCode.FirmwareUpdateDownloadFailed:return new i.FirmwareDownloadFailed(e);case n.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot:return new i.FirmwareUpdateManuallyEnterBoot(e);case n.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure:return new i.FirmwareUpdateAutoEnterBootFailure(e);case n.HardwareErrorCode.FirmwareUpdateLimitOneDevice:return new i.FirmwareUpdateLimitOneDevice(e);case n.HardwareErrorCode.CallMethodNeedUpgradeFirmware:return new i.FirmwareVersionTooLow(e);case n.HardwareErrorCode.NewFirmwareUnRelease:return new i.NewFirmwareUnRelease(e);case n.HardwareErrorCode.NewFirmwareForceUpdate:return new i.NewFirmwareForceUpdate(e);case n.HardwareErrorCode.NetworkError:return new i.NetworkError(e);case n.HardwareErrorCode.BlePermissionError:return new i.NeedBluetoothTurnedOn(e);case n.HardwareErrorCode.BleLocationError:return new i.NeedBluetoothPermissions({message:d});case n.HardwareErrorCode.BleLocationServicesDisabled:return new i.BleLocationServiceError({message:d});case n.HardwareErrorCode.BleDeviceNotBonded:return new i.DeviceNotBonded(e);case n.HardwareErrorCode.BleDeviceBondError:return new i.DeviceBondError(e);case n.HardwareErrorCode.BleWriteCharacteristicError:return new i.BleWriteCharacteristicError(e);case n.HardwareErrorCode.BleScanError:return new i.BleScanError({message:d});case n.HardwareErrorCode.BleAlreadyConnected:return new i.BleAlreadyConnectedError(e);case n.HardwareErrorCode.RuntimeError:return-1!==d.indexOf("EIP712 blind sign is disabled")?new i.OpenBlindSign(e):-1!==d.indexOf("Unknown message")||-1!==d.indexOf("Failure_UnexpectedMessage")?new i.UnknownMethod(e):new i.UnknownHardwareError(e);case n.HardwareErrorCode.PinInvalid:return new i.InvalidPIN(e);case n.HardwareErrorCode.DeviceCheckPassphraseStateError:return new i.InvalidPassphrase(e);case n.HardwareErrorCode.DeviceOpenedPassphrase:return new i.DeviceOpenedPassphrase(e);case n.HardwareErrorCode.DeviceNotOpenedPassphrase:return new i.DeviceNotOpenedPassphrase(e);case n.HardwareErrorCode.PinCancelled:case n.HardwareErrorCode.ActionCancelled:return new i.UserCancel(e);case n.HardwareErrorCode.BridgeNotInstalled:case i.CustomOneKeyHardwareError.NeedOneKeyBridge:return new i.NeedOneKeyBridge(e);case n.HardwareErrorCode.BridgeNetworkError:return new i.BridgeNetworkError(e);case n.HardwareErrorCode.BridgeTimeoutError:return new i.BridgeTimeoutError(e);case n.HardwareErrorCode.PollingTimeout:return new i.ConnectTimeoutError(e);case n.HardwareErrorCode.PollingStop:return new i.ConnectPollingStopError(e);case n.HardwareErrorCode.BlindSignDisabled:return new i.OpenBlindSign(e);case n.HardwareErrorCode.FileAlreadyExists:return new i.FileAlreadyExistError(e);case n.HardwareErrorCode.CheckDownloadFileError:return new i.IncompleteFileError(e);case n.HardwareErrorCode.NotInSigningMode:return new i.NotInSigningModeError(e);default:return new i.UnknownHardwareError(e)}}}}]);